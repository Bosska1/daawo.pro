
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stream Player</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #000;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }
    
    #playerContainer {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #videoPlayer {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    #playButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      background: rgba(56, 239, 125, 0.2);
      border: 2px solid #38ef7d;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      animation: pulse 2s infinite;
    }
    
    #playButton:before {
      content: '';
      width: 0;
      height: 0;
      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      border-left: 25px solid #38ef7d;
      margin-left: 5px;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(56, 239, 125, 0.4); }
      70% { box-shadow: 0 0 0 20px rgba(56, 239, 125, 0); }
      100% { box-shadow: 0 0 0 0 rgba(56, 239, 125, 0); }
    }
    
    #loadingContainer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: #000;
      z-index: 5;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 4px solid rgba(56, 239, 125, 0.1);
      border-top-color: #38ef7d;
      border-right-color: #3b82f6;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    #loadingText {
      font-size: 18px;
      background: linear-gradient(to right, #3b82f6, #38ef7d);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: bold;
    }
    
    #loadingProgress {
      font-size: 16px;
      color: #9ca3af;
      margin-top: 5px;
    }
    
    #errorContainer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 10;
      display: none;
    }
    
    #errorIcon {
      font-size: 48px;
      margin-bottom: 16px;
      color: #f43f5e;
    }
    
    #errorMessage {
      font-size: 18px;
      margin-bottom: 16px;
      text-align: center;
      max-width: 80%;
    }
    
    #retryBtn, #sourceBtn {
      background: linear-gradient(to right, #3b82f6, #38ef7d);
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
      transition: all 0.2s ease;
    }
    
    #retryBtn:hover, #sourceBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(56, 239, 125, 0.3);
    }
    
    #controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
      padding: 20px;
      display: flex;
      align-items: center;
      z-index: 8;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    #controls.show {
      opacity: 1;
    }
    
    .control-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
    }
    
    #fullscreenBtn {
      margin-left: auto;
    }
    
    #pwaPrompt {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
      text-align: center;
      display: none;
    }
    
    #pwaIcon {
      font-size: 64px;
      margin-bottom: 20px;
    }
    
    #pwaTitle {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
      background: linear-gradient(to right, #3b82f6, #38ef7d);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    #pwaMessage {
      font-size: 16px;
      margin-bottom: 20px;
      color: #e5e7eb;
      max-width: 300px;
    }
    
    #pwaSteps {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      width: 100%;
      max-width: 300px;
      text-align: left;
    }
    
    .pwa-step {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .pwa-step:last-child {
      margin-bottom: 0;
    }
    
    .step-number {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(to right, #3b82f6, #38ef7d);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 10px;
      flex-shrink: 0;
    }
    
    #pwaButton {
      background: linear-gradient(to right, #3b82f6, #38ef7d);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    #pwaButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(56, 239, 125, 0.3);
    }
    
    #matchInfo {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 8;
    }
    
    .team-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0 15px;
    }
    
    .team-flag {
      font-size: 24px;
      margin-bottom: 5px;
    }
    
    .team-name {
      font-size: 14px;
      font-weight: bold;
    }
    
    .score-container {
      display: flex;
      align-items: center;
      margin: 0 15px;
    }
    
    .score {
      font-size: 20px;
      font-weight: bold;
      padding: 5px 10px;
      background: rgba(56, 239, 125, 0.2);
      border-radius: 5px;
      min-width: 30px;
      text-align: center;
    }
    
    .score-divider {
      margin: 0 5px;
      color: #9ca3af;
    }
    
    #liveIndicator {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(239, 68, 68, 0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      display: flex;
      align-items: center;
      z-index: 9;
    }
    
    #liveIndicator:before {
      content: '';
      width: 8px;
      height: 8px;
      background-color: #ef4444;
      border-radius: 50%;
      margin-right: 5px;
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <div id="playerContainer">
    <video id="videoPlayer" playsinline></video>
    
    <div id="playButton"></div>
    
    <div id="matchInfo">
      <div class="team-info">
        <div id="teamAFlag" class="team-flag"></div>
        <div id="teamAName" class="team-name"></div>
      </div>
      
      <div class="score-container">
        <div id="scoreA" class="score">0</div>
        <div class="score-divider">-</div>
        <div id="scoreB" class="score">0</div>
      </div>
      
      <div class="team-info">
        <div id="teamBFlag" class="team-flag"></div>
        <div id="teamBName" class="team-name"></div>
      </div>
    </div>
    
    <div id="liveIndicator">LIVE</div>
    
    <div id="controls" class="show">
      <button id="playPauseBtn" class="control-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
      </button>
      
      <button id="muteBtn" class="control-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
          <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
        </svg>
      </button>
      
      <button id="fullscreenBtn" class="control-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
        </svg>
      </button>
    </div>
  </div>
  
  <div id="loadingContainer">
    <div class="spinner"></div>
    <div id="loadingText">Loading your stream...</div>
    <div id="loadingProgress">0%</div>
  </div>
  
  <div id="errorContainer">
    <div id="errorIcon">‚ö†Ô∏è</div>
    <div id="errorMessage">Unable to load the stream</div>
    <div>
      <button id="retryBtn">Try Again</button>
      <button id="sourceBtn">Try Another Source</button>
    </div>
  </div>
  
  <div id="pwaPrompt">
    <div id="pwaIcon">üì±</div>
    <div id="pwaTitle">Install StreamGoal App</div>
    <div id="pwaMessage">
      To watch streams, please install our app on your device.
    </div>
    <div id="pwaSteps">
      <div class="pwa-step">
        <div class="step-number">1</div>
        <div>Tap the Share button</div>
      </div>
      <div class="pwa-step">
        <div class="step-number">2</div>
        <div>Scroll and tap "Add to Home Screen"</div>
      </div>
      <div class="pwa-step">
        <div class="step-number">3</div>
        <div>Tap "Add" to install</div>
      </div>
    </div>
    <button id="pwaButton">Got it</button>
  </div>

  <script>
    // DOM elements
    const videoPlayer = document.getElementById('videoPlayer');
    const playerContainer = document.getElementById('playerContainer');
    const playButton = document.getElementById('playButton');
    const loadingContainer = document.getElementById('loadingContainer');
    const loadingProgress = document.getElementById('loadingProgress');
    const errorContainer = document.getElementById('errorContainer');
    const errorMessage = document.getElementById('errorMessage');
    const retryBtn = document.getElementById('retryBtn');
    const sourceBtn = document.getElementById('sourceBtn');
    const controls = document.getElementById('controls');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const muteBtn = document.getElementById('muteBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const pwaPrompt = document.getElementById('pwaPrompt');
    const pwaButton = document.getElementById('pwaButton');
    
    // Match info elements
    const teamAFlag = document.getElementById('teamAFlag');
    const teamAName = document.getElementById('teamAName');
    const teamBFlag = document.getElementById('teamBFlag');
    const teamBName = document.getElementById('teamBName');
    const scoreA = document.getElementById('scoreA');
    const scoreB = document.getElementById('scoreB');
    
    // Parse URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const streamUrl = urlParams.get('url');
    const teamA = urlParams.get('teamA');
    const teamB = urlParams.get('teamB');
    const teamAFlagValue = urlParams.get('teamAFlag');
    const teamBFlagValue = urlParams.get('teamBFlag');
    const scoreAValue = urlParams.get('scoreA') || '0';
    const scoreBValue = urlParams.get('scoreB') || '0';
    
    // Alternative stream sources
    const alternativeSources = [
      'https://www.youtube.com/embed/live_stream?channel=UCQfwfsi5VrQ8yKZ-UWmAEFg&autoplay=1',
      'https://www.youtube.com/embed/live_stream?channel=UCEgdi0XIXXZ-qJOFPf4JSKw&autoplay=1',
      'https://www.youtube.com/embed/live_stream?channel=UCW-OEJUl-_zQWrBXzAkW9ew&autoplay=1'
    ];
    
    let currentSourceIndex = 0;
    let progressInterval;
    let loadingTimeout;
    let controlsTimeout;
    
    // Check if it's iOS
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    
    // Check if running as standalone PWA
    const isRunningAsPWA = window.matchMedia('(display-mode: standalone)').matches || 
                          window.navigator.standalone || 
                          document.referrer.includes('android-app://');
    
    // If it's iOS and not running as PWA, show the PWA prompt
    if (isIOS && !isRunningAsPWA) {
      pwaPrompt.style.display = 'flex';
      loadingContainer.style.display = 'none';
    }
    
    // Update match info
    if (teamA) teamAName.textContent = teamA;
    if (teamB) teamBName.textContent = teamB;
    if (teamAFlagValue) teamAFlag.textContent = teamAFlagValue;
    if (teamBFlagValue) teamBFlag.textContent = teamBFlagValue;
    if (scoreAValue) scoreA.textContent = scoreAValue;
    if (scoreBValue) scoreB.textContent = scoreBValue;
    
    // Function to show loading
    function showLoading() {
      loadingContainer.style.display = 'flex';
      errorContainer.style.display = 'none';
      playButton.style.display = 'none';
      
      // Clear any existing intervals
      if (progressInterval) clearInterval(progressInterval);
      
      // Animate progress
      let progress = 0;
      progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 99) {
          progress = 99;
          clearInterval(progressInterval);
        }
        loadingProgress.textContent = `${Math.floor(progress)}%`;
      }, 100);
      
      // Set timeout to show error if loading takes too long
      if (loadingTimeout) clearTimeout(loadingTimeout);
      loadingTimeout = setTimeout(() => {
        showError('Stream is taking too long to load. Please try again.');
      }, 10000);
    }
    
    // Function to hide loading
    function hideLoading() {
      loadingContainer.style.display = 'none';
      if (progressInterval) clearInterval(progressInterval);
      if (loadingTimeout) clearTimeout(loadingTimeout);
    }
    
    // Function to show error
    function showError(message) {
      loadingContainer.style.display = 'none';
      errorContainer.style.display = 'flex';
      errorMessage.textContent = message || 'Unable to load the stream';
      
      // Notify parent window
      try {
        window.parent.postMessage('videoError', '*');
      } catch (e) {
        console.error('Error sending message to parent:', e);
      }
    }
    
    // Function to show/hide controls
    function showControls() {
      controls.classList.add('show');
      
      if (controlsTimeout) {
        clearTimeout(controlsTimeout);
      }
      
      controlsTimeout = setTimeout(() => {
        controls.classList.remove('show');
      }, 3000);
    }
    
    // Function to load stream
    function loadStream(url) {
      if (!url) {
        showError('No stream URL provided');
        return;
      }
      
      showLoading();
      
      // Set video source
      videoPlayer.src = url;
      videoPlayer.muted = true; // Start muted to help with autoplay
      
      // Play video
      videoPlayer.play()
        .then(() => {
          hideLoading();
          playButton.style.display = 'none';
          showControls();
          
          // Notify parent window
          try {
            window.parent.postMessage('videoPlaying', '*');
          } catch (e) {
            console.error('Error sending message to parent:', e);
          }
        })
        .catch(error => {
          console.error('Error playing video:', error);
          
          // Show play button if autoplay fails
          hideLoading();
          playButton.style.display = 'flex';
          
          // Handle specific errors
          if (error.name === 'NotAllowedError') {
            // Autoplay was prevented
            console.log('Autoplay prevented, showing play button');
          } else {
            // Other error, try direct iframe for YouTube URLs
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
              loadYouTubeIframe(url);
            } else {
              showError('Stream error. Please try again.');
            }
          }
        });
    }
    
    // Function to load YouTube iframe
    function loadYouTubeIframe(url) {
      // Remove video player
      videoPlayer.pause();
      videoPlayer.removeAttribute('src');
      videoPlayer.load();
      videoPlayer.style.display = 'none';
      
      // Create iframe
      const iframe = document.createElement('iframe');
      iframe.src = url;
      iframe.width = '100%';
      iframe.height = '100%';
      iframe.frameBorder = '0';
      iframe.allowFullscreen = true;
      iframe.allow = 'autoplay; fullscreen';
      
      // Add iframe to container
      playerContainer.appendChild(iframe);
      
      // Hide loading
      hideLoading();
      
      // Notify parent window
      try {
        window.parent.postMessage('videoPlaying', '*');
      } catch (e) {
        console.error('Error sending message to parent:', e);
      }
    }
    
    // Function to try alternative source
    function tryAlternativeSource() {
      currentSourceIndex = (currentSourceIndex + 1) % alternativeSources.length;
      loadStream(alternativeSources[currentSourceIndex]);
    }
    
    // Start loading the stream if not on iOS or running as PWA
    if (!isIOS || isRunningAsPWA) {
      if (streamUrl) {
        loadStream(streamUrl);
      } else {
        loadStream(alternativeSources[0]);
      }
    }
    
    // Event listeners
    playButton.addEventListener('click', function() {
      videoPlayer.play()
        .then(() => {
          playButton.style.display = 'none';
          showControls();
        })
        .catch(error => {
          console.error('Error playing video:', error);
          showError('Browser blocked autoplay. Please try again.');
        });
    });
    
    retryBtn.addEventListener('click', function() {
      if (streamUrl) {
        loadStream(streamUrl);
      } else {
        loadStream(alternativeSources[currentSourceIndex]);
      }
    });
    
    sourceBtn.addEventListener('click', function() {
      tryAlternativeSource();
    });
    
    pwaButton.addEventListener('click', function() {
      window.parent.location.href = '/';
    });
    
    // Video event listeners
    videoPlayer.addEventListener('playing', function() {
      hideLoading();
      playButton.style.display = 'none';
      playPauseBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>';
    });
    
    videoPlayer.addEventListener('pause', function() {
      playPauseBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>';
    });
    
    videoPlayer.addEventListener('error', function() {
      showError('Stream error. Please try again.');
    });
    
    // Control button event listeners
    playPauseBtn.addEventListener('click', function() {
      if (videoPlayer.paused) {
        videoPlayer.play();
      } else {
        videoPlayer.pause();
      }
    });
    
    muteBtn.addEventListener('click', function() {
      videoPlayer.muted = !videoPlayer.muted;
      
      if (videoPlayer.muted) {
        muteBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>';
      } else {
        muteBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';
      }
    });
    
    fullscreenBtn.addEventListener('click', function() {
      if (document.fullscreenElement) {
        document.exitFullscreen();
      } else {
        playerContainer.requestFullscreen();
      }
    });
    
    // Show controls when user moves mouse or taps screen
    playerContainer.addEventListener('mousemove', showControls);
    playerContainer.addEventListener('touchstart', showControls);
    
    // Listen for messages from parent window
    window.addEventListener('message', function(event) {
      if (event.data === 'toggleMute') {
        videoPlayer.muted = !videoPlayer.muted;
        
        if (videoPlayer.muted) {
          muteBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>';
        } else {
          muteBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';
        }
      }
    });
  </script>
</body>
</html>